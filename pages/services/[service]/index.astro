---
import services from '~/data/services.json';
import { getBuildableSuburbsForService } from '~/lib/links/buildable';
import MainLayout from '~/layouts/MainLayout.astro';
import SchemaGraph from '~/components/SchemaGraph.astro';
import FaqSection from '~/components/FaqSection.astro';
import ContactCta from '~/components/ContactCta.astro';

export async function getStaticPaths() {
  return services.map(svc => ({ params: { service: svc.slug }, props: { service: svc } }));
}

const { service } = Astro.props;
const title = service.slug === 'spring-cleaning'
  ? 'Spring Cleaning Ipswich & Brisbane | One N Done'
  : `${service.title} – Professional ${service.title} in Brisbane, Logan & Ipswich`;
const description = service.slug === 'spring-cleaning'
  ? 'Top-to-bottom spring cleaning — kitchens, bathrooms, fans & tracks. Police-checked, insured, 7-day re-clean. Get a fast quote today.'
  : service.description;
import { absoluteUrl } from '~/lib/url';
const canonical = absoluteUrl(`/services/${service.slug}/`);

// Get all buildable suburbs for this service with proper display names
const buildableSuburbs = getBuildableSuburbsForService(service.slug);

// Group by cluster for better organization
const byCluster = buildableSuburbs.reduce((acc, suburb) => {
  const cluster = suburb.cluster || 'Other';
  if (!acc[cluster]) acc[cluster] = [];
  acc[cluster].push(suburb);
  return acc;
}, {} as Record<string, typeof buildableSuburbs>);

// Prioritize clusters and take top 3 from each for "popular areas"
const clusterOrder = ['ipswich', 'brisbane', 'logan', 'Other'];
const popularAreas = clusterOrder
  .filter(cluster => byCluster[cluster])
  .flatMap(cluster => byCluster[cluster].slice(0, 3))
  .slice(0, 9); // Max 9 popular areas

// Minimal breadcrumb for hubs (Services > Service)
const siteUrl = (import.meta.env.SITE || 'https://onendonebondclean.com.au');
const breadcrumb = {
  itemListElement: [
    { '@type': 'ListItem', position: 1, name: 'Services', item: new URL('/services', siteUrl).toString() },
    { '@type': 'ListItem', position: 2, name: service.title }
  ]
};
---
<MainLayout title={title} description={description} canonical={canonical} breadcrumb={breadcrumb}>
  <Fragment slot="head">
    {service.slug === 'bond-cleaning' && (
      <SchemaGraph graph={[
        {
          '@type': 'Offer',
          name: 'Bond Cleaning Offer',
          category: 'bond-cleaning',
          // Keep conservative: minimal fields to satisfy type presence without pricing semantics
          url: canonical,
          itemOffered: { '@type': 'Service', name: service.title }
        }
      ]} />
    )}
  </Fragment>
  <section class="max-w-6xl mx-auto px-4 py-12">
    <h1 class="text-4xl font-extrabold text-slate-900">{service.title}</h1>
    <p class="mt-3 text-lg text-slate-700 max-w-3xl">{service.description}</p>

    {/* Service-specific CTA */}
    <div class="mt-6">
      <a href="#quote" class="inline-flex items-center gap-2 bg-sky-700 hover:bg-sky-800 text-white font-bold px-5 py-3 rounded-full shadow focus-visible:ring-4 focus-visible:ring-sky-500/40 transition">
        {service.slug === 'spring-cleaning' ? 'Get a Spring Clean Quote' : service.slug === 'bathroom-deep-clean' ? 'Book a Bathroom Deep Clean' : 'Get a Bond Clean Quote'}
      </a>
    </div>

  <h2 class="mt-10 text-2xl font-bold text-slate-900">Popular Areas</h2>
    <ul class="mt-4 grid sm:grid-cols-2 md:grid-cols-3 gap-3">
      {popularAreas.map(suburb => (
        <li>
          <a href={`/services/${service.slug}/${suburb.slug}/`} class="block bg-white px-4 py-3 rounded-xl shadow-sm border border-slate-200 hover:shadow-lg hover:border-sky-500/60 text-slate-900 hover:text-sky-500 transition">
            {suburb.name}
          </a>
        </li>
      ))}
    </ul>
    
    {/* Show coverage summary and link to full coverage */}
    <div class="mt-6 p-4 bg-slate-50 rounded-lg">
      <p class="text-slate-700">
        <strong>{buildableSuburbs.length} locations available</strong> across Brisbane, Logan, and Ipswich regions.
      </p>
      <details class="mt-3">
        <summary class="cursor-pointer text-sky-600 hover:text-sky-700 font-medium">
          View all {buildableSuburbs.length} service locations →
        </summary>
        <div class="mt-4 space-y-4">
          {clusterOrder.filter(cluster => byCluster[cluster]).map(cluster => (
            <div>
              <h4 class="font-medium text-slate-900 capitalize mb-2">
                {cluster === 'Other' ? 'Additional Areas' : `${cluster} Region`} ({byCluster[cluster].length})
              </h4>
              <ul class="grid sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2 text-sm">
                {byCluster[cluster].map(suburb => (
                  <li>
                    <a href={`/services/${service.slug}/${suburb.slug}/`} class="text-sky-600 hover:text-sky-700 hover:underline">
                      {suburb.name}
                    </a>
                  </li>
                ))}
              </ul>
            </div>
          ))}
        </div>
      </details>
    </div>
  </section>
  {/* Bond-cleaning proof & policy callouts */}
  {service.slug === 'bond-cleaning' && (
    <section class="max-w-6xl mx-auto px-4 py-8">
      <div class="grid md:grid-cols-2 gap-6">
        <div class="bg-white rounded-xl border border-slate-200 p-5 shadow-sm">
          <h3 class="text-xl font-semibold text-slate-900">Agent‑ready checklist</h3>
          <p class="mt-2 text-slate-700">We clean to the expectations of local property managers: kitchens and appliances exteriors, bathrooms and grout detail, tracks and sills, fans and fittings, skirting, switches, floors and more.</p>
        </div>
        <div class="bg-white rounded-xl border border-slate-200 p-5 shadow-sm">
          <h3 class="text-xl font-semibold text-slate-900">7‑day re‑clean support</h3>
          <p class="mt-2 text-slate-700">If your agent flags a reasonable miss within 7 days, we’ll return to make it right. Simple, fair and fast.</p>
        </div>
      </div>
    </section>
  )}
  {/* Inclusions grid (brief) */}
  <section class="max-w-6xl mx-auto px-4 py-8">
    <h2 class="text-2xl font-bold text-slate-900">What’s included</h2>
    <ul class="mt-4 grid sm:grid-cols-2 md:grid-cols-3 gap-3 text-slate-800">
      {service.checklist?.map((it) => (
        <li class="bg-white px-4 py-3 rounded-xl border border-slate-200 shadow-sm">{it}</li>
      ))}
    </ul>
  </section>
  <section class="max-w-6xl mx-auto px-4 py-6">
    <FaqSection
      items={(
        service.slug === 'bond-cleaning' ? [] :
        service.slug === 'spring-cleaning' ? [] :
        []
      )}
      heading={`${service.title} FAQs`}
      id="service-faq"
    />
  </section>

  <section class="max-w-6xl mx-auto px-4 py-8">
    <ContactCta 
      title={`Ready to book ${service.title.toLowerCase()}?`}
      description={`Get a fast, free quote for professional ${service.title.toLowerCase()}. Our experienced team provides reliable service across Brisbane, Logan, and Ipswich.`}
    />
  </section>
</MainLayout>
